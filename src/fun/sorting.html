---
layout: false
permalink: /fun/sorting/
---
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Interactive sorting algorithm visualizer" />
        <title>Sorting Visualizer</title>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/assets/css/fun-pages.css">

        <style>
            :root {
                --bg-deep: #0a0a12;
                --bg-surface: #10101a;
                --bg-elevated: #181824;
                --accent: #9d4edd;
                --accent-rgb: 157, 78, 221;
                --accent-dim: rgba(157, 78, 221, 0.3);
                --accent-glow: rgba(157, 78, 221, 0.15);
                --bar-default: #4a4a6a;
                --bar-compare: #ff6b6b;
                --bar-swap: #ffd93d;
                --bar-sorted: #4edd9d;
                --bar-pivot: #4ecdc4;
                --error: #ff6b6b;
                --success: #4edd9d;
            }

            .top-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                line-height: 1;
            }

            .code-btn { right: 4rem; }
            .results-btn { right: 7rem; }

            .stats-bar {
                gap: 1.5rem;
                font-size: 0.8rem;
            }

            .stat { gap: 0.4rem; }
            .stat-value { font-size: 0.75rem; }

            .main-content {
                flex: 1;
                display: flex;
                gap: 1rem;
                padding: 0 1rem;
                min-height: 300px;
                position: relative;
                overflow: hidden;
            }

            .visualizer-container {
                flex: 1;
                display: flex;
                justify-content: center;
                align-items: flex-end;
            }

            .bars-container {
                display: flex;
                align-items: flex-end;
                justify-content: center;
                gap: 1px;
                height: 500px;
                width: 100%;
                max-width: 900px;
                padding: 0 10px;
            }

            .bar {
                background: var(--bar-default);
                transition: height 0.05s ease, background 0.1s ease;
                border-radius: 2px 2px 0 0;
                min-width: 2px;
            }

            .bar.comparing { background: var(--bar-compare); }
            .bar.swapping { background: var(--bar-swap); }
            .bar.sorted { background: var(--bar-sorted); }
            .bar.pivot { background: var(--bar-pivot); }

            /* Results Panel */
            .results-panel {
                position: absolute;
                left: 1rem;
                top: 0;
                height: 100%;
                width: 280px;
                z-index: 50;
                display: flex;
                flex-direction: column;
                background: var(--bg-surface);
                border: 1px solid var(--border);
                border-radius: 8px;
                transform: translateX(calc(-100% - 2rem));
                transition: transform 0.3s ease;
            }

            .results-panel.open { transform: translateX(0); }

            .results-panel-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.75rem 1rem;
                border-bottom: 1px solid var(--border);
                background: var(--bg-elevated);
            }

            .results-panel-title {
                font-size: 0.85rem;
                color: var(--accent);
            }

            .results-list {
                flex: 1;
                overflow-y: auto;
                padding: 0.5rem;
            }

            .result-item {
                background: var(--bg-elevated);
                border: 1px solid var(--border);
                border-radius: 4px;
                padding: 0.5rem 0.75rem;
                margin-bottom: 0.5rem;
                font-size: 0.7rem;
            }

            .result-item:last-child { margin-bottom: 0; }

            .result-algo {
                color: var(--accent);
                font-weight: 500;
                margin-bottom: 0.25rem;
            }

            .result-stats {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 0.2rem;
                color: var(--text-secondary);
            }

            .result-stats span { color: var(--text-primary); }

            .results-empty {
                color: var(--text-secondary);
                font-size: 0.75rem;
                text-align: center;
                padding: 2rem 1rem;
            }

            /* Code Editor Panel */
            .code-panel {
                position: absolute;
                right: 1rem;
                top: 0;
                height: 100%;
                width: 450px;
                z-index: 50;
                display: flex;
                flex-direction: column;
                background: var(--bg-surface);
                border: 1px solid var(--border);
                border-radius: 8px;
                transform: translateX(calc(100% + 2rem));
                transition: transform 0.3s ease;
            }

            .code-panel.open { transform: translateX(0); }

            .code-panel-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.75rem 1rem;
                border-bottom: 1px solid var(--border);
                background: var(--bg-elevated);
            }

            .code-panel-title {
                font-size: 0.85rem;
                color: var(--accent);
            }

            .code-panel-actions {
                display: flex;
                gap: 0.5rem;
            }

            .code-panel-actions button {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
            }

            .code-editor {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            .code-editor textarea {
                flex: 1;
                background: var(--bg-deep);
                border: none;
                color: var(--text-primary);
                font-family: 'JetBrains Mono', monospace;
                font-size: 0.75rem;
                line-height: 1.5;
                padding: 1rem;
                resize: none;
                outline: none;
                tab-size: 2;
            }

            .code-editor textarea::placeholder { color: var(--text-secondary); }

            .code-status {
                padding: 0.5rem 1rem;
                font-size: 0.7rem;
                border-top: 1px solid var(--border);
                background: var(--bg-elevated);
            }

            .code-status.error { color: var(--error); }
            .code-status.success { color: var(--success); }

            .controls { max-width: 900px; }

            button:hover:not(:disabled) {
                border-color: var(--accent);
                background: var(--accent-glow);
            }

            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .slider-control input[type="range"] { width: 100px; }
            .slider-label { min-width: 50px; }
            .slider-value { min-width: 35px; }

            .section-label {
                font-size: 0.75rem;
                color: var(--text-secondary);
            }

            .modal { max-width: 600px; }

            .modal h3 {
                color: var(--accent);
                margin: 1rem 0 0.5rem;
                font-size: 1rem;
            }

            .modal code {
                background: var(--bg-elevated);
                padding: 0.1rem 0.3rem;
                border-radius: 3px;
                color: var(--accent);
            }

            .legend {
                display: flex;
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
                margin-top: 0.5rem;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 0.3rem;
                font-size: 0.7rem;
                color: var(--text-secondary);
            }

            .legend-color {
                width: 12px;
                height: 12px;
                border-radius: 2px;
            }

            .complexity-badge {
                font-size: 0.65rem;
                padding: 2px 6px;
                border-radius: 3px;
                background: var(--bg-deep);
                color: var(--text-secondary);
                margin-left: 0.5rem;
            }

            @media (max-width: 900px) {
                .code-panel.open,
                .results-panel.open {
                    width: calc(100% - 2rem);
                    max-height: 50%;
                    left: 1rem;
                    right: 1rem;
                }
            }

            @media (max-width: 480px) {
                .slider-control input[type="range"] { width: 70px; }
                .bars-container { height: 300px; }
            }
        </style>
    </head>
    <body>
        <a href="/fun/" class="back-link">&larr; back</a>
        <button class="top-btn results-btn" id="resultsBtn" title="Results History">&#9776;</button>
        <button class="top-btn code-btn" id="codeBtn" title="Code Editor">&lt;/&gt;</button>
        <button class="top-btn help-btn" id="helpBtn" title="Help (?)">?</button>

        <header class="game-header">
            <h1 class="game-title">Sorting Visualizer</h1>
            <div class="stats-bar">
                <div class="stat">
                    <span class="stat-label">Algorithm:</span>
                    <span class="stat-value" id="algoDisplay">Quick Sort</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Comparisons:</span>
                    <span class="stat-value" id="comparisonsDisplay">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Swaps:</span>
                    <span class="stat-value" id="swapsDisplay">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Time:</span>
                    <span class="stat-value" id="timeDisplay">0ms</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="results-panel" id="resultsPanel">
                <div class="results-panel-header">
                    <span class="results-panel-title">Run History</span>
                    <button id="clearResultsBtn" style="padding: 0.2rem 0.5rem; font-size: 0.7rem;">Clear</button>
                </div>
                <div class="results-list" id="resultsList">
                    <div class="results-empty">No runs yet. Click Sort to begin.</div>
                </div>
            </div>

            <div class="visualizer-container">
                <div class="bars-container" id="barsContainer"></div>
            </div>

            <div class="code-panel" id="codePanel">
                <div class="code-panel-header">
                    <span class="code-panel-title">Algorithm Editor</span>
                    <div class="code-panel-actions">
                        <button id="resetCodeBtn">Reset</button>
                        <button id="runCodeBtn" class="primary">Run</button>
                    </div>
                </div>
                <div class="code-editor">
                    <textarea id="codeEditor" spellcheck="false" placeholder="Select an algorithm to view and edit its code..."></textarea>
                </div>
                <div class="code-status" id="codeStatus">Ready to edit</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-row">
                <button class="primary" id="sortBtn">Sort</button>
                <button id="shuffleBtn">Shuffle</button>
                <button id="stopBtn" disabled>Stop</button>
            </div>
            <div class="control-row">
                <span class="section-label">Algorithm:</span>
                <button data-algo="bubble">Bubble</button>
                <button data-algo="selection">Selection</button>
                <button data-algo="insertion">Insertion</button>
                <button data-algo="merge">Merge</button>
                <button data-algo="quick" class="active">Quick</button>
                <button data-algo="heap">Heap</button>
            </div>
            <div class="control-row">
                <span class="section-label">Pattern:</span>
                <button data-pattern="random" class="active">Random</button>
                <button data-pattern="nearly">Nearly Sorted</button>
                <button data-pattern="reversed">Reversed</button>
                <button data-pattern="fewunique">Few Unique</button>
            </div>
            <div class="control-row">
                <div class="slider-control">
                    <span class="slider-label">Size:</span>
                    <input type="range" id="sizeSlider" min="10" max="200" value="50">
                    <span class="slider-value" id="sizeValue">50</span>
                </div>
                <div class="slider-control">
                    <span class="slider-label">Speed:</span>
                    <input type="range" id="speedSlider" min="1" max="100" value="50">
                    <span class="slider-value" id="speedValue">50</span>
                </div>
            </div>
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: var(--bar-default);"></div> Unsorted</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--bar-compare);"></div> Comparing</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--bar-swap);"></div> Swapping</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--bar-pivot);"></div> Pivot</div>
                <div class="legend-item"><div class="legend-color" style="background: var(--bar-sorted);"></div> Sorted</div>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="modal-overlay" id="helpModal">
            <div class="modal">
                <h2>Sorting Visualizer</h2>
                <p>Watch different sorting algorithms organize data in real-time.</p>

                <h3>Algorithms</h3>
                <ul>
                    <li><strong>Bubble Sort</strong> <span class="complexity-badge">O(n&sup2;)</span> - Repeatedly swaps adjacent out-of-order elements</li>
                    <li><strong>Selection Sort</strong> <span class="complexity-badge">O(n&sup2;)</span> - Finds minimum and places at front</li>
                    <li><strong>Insertion Sort</strong> <span class="complexity-badge">O(n&sup2;)</span> - Builds sorted portion one element at a time</li>
                    <li><strong>Merge Sort</strong> <span class="complexity-badge">O(n log n)</span> - Divide and conquer, merges sorted halves</li>
                    <li><strong>Quick Sort</strong> <span class="complexity-badge">O(n log n)</span> - Partitions around a pivot element</li>
                    <li><strong>Heap Sort</strong> <span class="complexity-badge">O(n log n)</span> - Uses heap data structure</li>
                </ul>

                <h3>Code Editor</h3>
                <p>Click the <code>&lt;/&gt;</code> button to open the code editor. You can modify algorithms and click "Run" to test your changes.</p>
                <p>Available helpers: <code>compare(i, j)</code>, <code>swap(i, j)</code>, <code>markSorted(indices)</code>, <code>setPivot(i)</code></p>

                <h3>Keyboard Shortcuts</h3>
                <ul>
                    <li><strong>Space</strong> - Start/Stop sorting</li>
                    <li><strong>R</strong> - Shuffle array</li>
                    <li><strong>E</strong> - Toggle code editor</li>
                    <li><strong>H</strong> - Toggle results history</li>
                    <li><strong>1-6</strong> - Select algorithm</li>
                    <li><strong>Escape</strong> - Stop animation</li>
                </ul>

                <button class="modal-close" id="closeHelp">Got it</button>
            </div>
        </div>

        <script>
            // State
            let array = [];
            let arraySize = 50;
            let animationSpeed = 50;
            let isAnimating = false;
            let shouldStop = false;
            let algorithm = 'quick';
            let pattern = 'random';

            // Stats
            let comparisons = 0;
            let swaps = 0;
            let startTime = 0;

            const container = document.getElementById('barsContainer');
            const codeEditor = document.getElementById('codeEditor');
            const codeStatus = document.getElementById('codeStatus');
            const resultsList = document.getElementById('resultsList');

            // Results history
            let results = [];

            const ALGO_NAMES = {
                bubble: 'Bubble Sort',
                selection: 'Selection Sort',
                insertion: 'Insertion Sort',
                merge: 'Merge Sort',
                quick: 'Quick Sort',
                heap: 'Heap Sort'
            };

            // Algorithm source code templates
            const SORT_ALGORITHMS = {
                bubble: `// Bubble Sort - O(n²)
// Repeatedly swaps adjacent elements if out of order
async function sort(ctx) {
  const n = ctx.length();

  for (let i = n - 1; i > 0 && ctx.isRunning(); i--) {
    let swapped = false;

    for (let j = 0; j < i && ctx.isRunning(); j++) {
      if (await ctx.compare(j, j + 1) > 0) {
        await ctx.swap(j, j + 1);
        swapped = true;
      }
    }

    ctx.markSorted([i]);
    if (!swapped) break;
  }

  ctx.markSorted([0]);
}`,

                selection: `// Selection Sort - O(n²)
// Finds minimum element and places it at front
async function sort(ctx) {
  const n = ctx.length();

  for (let i = 0; i < n - 1 && ctx.isRunning(); i++) {
    let minIdx = i;

    for (let j = i + 1; j < n && ctx.isRunning(); j++) {
      if (await ctx.compare(j, minIdx) < 0) {
        minIdx = j;
      }
    }

    if (minIdx !== i) {
      await ctx.swap(i, minIdx);
    }

    ctx.markSorted([i]);
  }

  ctx.markSorted([n - 1]);
}`,

                insertion: `// Insertion Sort - O(n²)
// Builds sorted portion one element at a time
async function sort(ctx) {
  const n = ctx.length();

  for (let i = 1; i < n && ctx.isRunning(); i++) {
    let j = i;

    while (j > 0 && ctx.isRunning()) {
      if (await ctx.compare(j - 1, j) > 0) {
        await ctx.swap(j - 1, j);
        j--;
      } else {
        break;
      }
    }
  }

  // Mark all as sorted
  ctx.markSorted([...Array(n).keys()]);
}`,

                merge: `// Merge Sort - O(n log n)
// Divide and conquer: splits, sorts, then merges
async function sort(ctx) {
  async function mergeSort(start, end) {
    if (start >= end || !ctx.isRunning()) return;

    const mid = Math.floor((start + end) / 2);
    await mergeSort(start, mid);
    await mergeSort(mid + 1, end);
    await merge(start, mid, end);
  }

  async function merge(start, mid, end) {
    const temp = [];
    let i = start, j = mid + 1;

    while (i <= mid && j <= end && ctx.isRunning()) {
      if (await ctx.compare(i, j) <= 0) {
        temp.push(ctx.get(i++));
      } else {
        temp.push(ctx.get(j++));
      }
    }

    while (i <= mid) temp.push(ctx.get(i++));
    while (j <= end) temp.push(ctx.get(j++));

    for (let k = 0; k < temp.length && ctx.isRunning(); k++) {
      await ctx.set(start + k, temp[k]);
    }
  }

  await mergeSort(0, ctx.length() - 1);
  ctx.markSorted([...Array(ctx.length()).keys()]);
}`,

                quick: `// Quick Sort - O(n log n) average
// Partitions array around a pivot element
async function sort(ctx) {
  async function quickSort(low, high) {
    if (low >= high || !ctx.isRunning()) return;

    const pivotIdx = await partition(low, high);
    ctx.markSorted([pivotIdx]);

    await quickSort(low, pivotIdx - 1);
    await quickSort(pivotIdx + 1, high);
  }

  async function partition(low, high) {
    ctx.setPivot(high);
    let i = low - 1;

    for (let j = low; j < high && ctx.isRunning(); j++) {
      if (await ctx.compare(j, high) < 0) {
        i++;
        await ctx.swap(i, j);
      }
    }

    await ctx.swap(i + 1, high);
    return i + 1;
  }

  await quickSort(0, ctx.length() - 1);
  ctx.markSorted([...Array(ctx.length()).keys()]);
}`,

                heap: `// Heap Sort - O(n log n)
// Uses max-heap to repeatedly extract maximum
async function sort(ctx) {
  const n = ctx.length();

  async function heapify(size, root) {
    let largest = root;
    const left = 2 * root + 1;
    const right = 2 * root + 2;

    if (left < size && await ctx.compare(left, largest) > 0) {
      largest = left;
    }

    if (right < size && await ctx.compare(right, largest) > 0) {
      largest = right;
    }

    if (largest !== root && ctx.isRunning()) {
      await ctx.swap(root, largest);
      await heapify(size, largest);
    }
  }

  // Build max heap
  for (let i = Math.floor(n / 2) - 1; i >= 0 && ctx.isRunning(); i--) {
    await heapify(n, i);
  }

  // Extract elements from heap
  for (let i = n - 1; i > 0 && ctx.isRunning(); i--) {
    await ctx.swap(0, i);
    ctx.markSorted([i]);
    await heapify(i, 0);
  }

  ctx.markSorted([0]);
}`
            };

            // Store custom code for each algorithm
            const customCode = { ...SORT_ALGORITHMS };

            // Sorted indices for visualization
            let sortedIndices = new Set();
            let pivotIndex = -1;
            let comparingIndices = [];
            let swappingIndices = [];

            // Initialize
            function init() {
                generateArray();
                updateCodeEditor();
            }

            // Generate array based on pattern
            function generateArray() {
                array = [];
                for (let i = 1; i <= arraySize; i++) {
                    array.push(i);
                }

                switch (pattern) {
                    case 'random':
                        shuffle(array);
                        break;
                    case 'nearly':
                        for (let i = 0; i < Math.floor(arraySize / 10); i++) {
                            const a = Math.floor(Math.random() * arraySize);
                            const b = Math.floor(Math.random() * arraySize);
                            [array[a], array[b]] = [array[b], array[a]];
                        }
                        break;
                    case 'reversed':
                        array.reverse();
                        break;
                    case 'fewunique':
                        array = Array(arraySize).fill(0).map(() =>
                            Math.floor(Math.random() * 5) + 1
                        );
                        break;
                }

                resetStats();
                sortedIndices.clear();
                pivotIndex = -1;
                comparingIndices = [];
                swappingIndices = [];
                renderBars();
            }

            function shuffle(arr) {
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
            }

            // Render bars
            function renderBars() {
                const maxVal = Math.max(...array, arraySize);
                const barWidth = Math.max(2, Math.floor((container.clientWidth - arraySize) / arraySize));

                container.innerHTML = '';

                for (let i = 0; i < array.length; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.height = `${(array[i] / maxVal) * 480}px`;
                    bar.style.width = `${barWidth}px`;

                    if (sortedIndices.has(i)) {
                        bar.classList.add('sorted');
                    } else if (pivotIndex === i) {
                        bar.classList.add('pivot');
                    } else if (swappingIndices.includes(i)) {
                        bar.classList.add('swapping');
                    } else if (comparingIndices.includes(i)) {
                        bar.classList.add('comparing');
                    }

                    container.appendChild(bar);
                }
            }

            // Stats
            function resetStats() {
                comparisons = 0;
                swaps = 0;
                startTime = 0;
                updateStats();
            }

            function updateStats() {
                document.getElementById('algoDisplay').textContent = ALGO_NAMES[algorithm];
                document.getElementById('comparisonsDisplay').textContent = comparisons;
                document.getElementById('swapsDisplay').textContent = swaps;

                if (startTime > 0) {
                    const elapsed = Date.now() - startTime;
                    document.getElementById('timeDisplay').textContent = `${elapsed}ms`;
                } else {
                    document.getElementById('timeDisplay').textContent = '0ms';
                }
            }

            // Animation helpers
            function getDelay() {
                return Math.max(1, 200 - animationSpeed * 2);
            }

            async function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // Main sort function
            async function startSort() {
                if (isAnimating) return;

                isAnimating = true;
                shouldStop = false;
                document.getElementById('sortBtn').disabled = true;
                document.getElementById('shuffleBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;

                resetStats();
                sortedIndices.clear();
                pivotIndex = -1;
                startTime = Date.now();

                // Create context for the algorithm
                const sortContext = {
                    length: () => array.length,
                    get: (i) => array[i],
                    isRunning: () => isAnimating && !shouldStop,

                    compare: async (i, j) => {
                        comparisons++;
                        comparingIndices = [i, j];
                        renderBars();
                        updateStats();
                        await sleep(getDelay());
                        comparingIndices = [];
                        return array[i] - array[j];
                    },

                    swap: async (i, j) => {
                        swaps++;
                        swappingIndices = [i, j];
                        [array[i], array[j]] = [array[j], array[i]];
                        renderBars();
                        updateStats();
                        await sleep(getDelay());
                        swappingIndices = [];
                    },

                    set: async (i, val) => {
                        array[i] = val;
                        swappingIndices = [i];
                        renderBars();
                        await sleep(getDelay() / 2);
                        swappingIndices = [];
                    },

                    markSorted: (indices) => {
                        indices.forEach(i => sortedIndices.add(i));
                        renderBars();
                    },

                    setPivot: (i) => {
                        pivotIndex = i;
                        renderBars();
                    }
                };

                let sortSucceeded = false;
                try {
                    const code = customCode[algorithm];
                    const sortFunc = new Function('ctx', `
                        return (async function() {
                            ${code}
                            return sort(ctx);
                        })();
                    `);
                    await sortFunc(sortContext);
                    setCodeStatus('Algorithm executed successfully', 'success');
                    sortSucceeded = true;
                } catch (err) {
                    setCodeStatus('Error: ' + err.message, 'error');
                    console.error(err);
                }

                updateStats();

                // Add to results if completed successfully
                if (sortSucceeded && !shouldStop) {
                    const elapsed = Date.now() - startTime;
                    addResult(algorithm, comparisons, swaps, elapsed, arraySize, pattern);
                }
                pivotIndex = -1;
                comparingIndices = [];
                swappingIndices = [];
                renderBars();

                isAnimating = false;
                document.getElementById('sortBtn').disabled = false;
                document.getElementById('shuffleBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            }

            function stopSort() {
                shouldStop = true;
            }

            // Code editor functions
            function updateCodeEditor() {
                codeEditor.value = customCode[algorithm];
                setCodeStatus('Ready to edit', '');
            }

            function setCodeStatus(message, type) {
                codeStatus.textContent = message;
                codeStatus.className = 'code-status' + (type ? ' ' + type : '');
            }

            function toggleCodePanel() {
                document.getElementById('codePanel').classList.toggle('open');
            }

            function toggleResultsPanel() {
                document.getElementById('resultsPanel').classList.toggle('open');
            }

            const PATTERN_NAMES = {
                random: 'Random',
                nearly: 'Nearly Sorted',
                reversed: 'Reversed',
                fewunique: 'Few Unique'
            };

            function addResult(algo, comps, swps, time, size, pat) {
                results.unshift({
                    algorithm: ALGO_NAMES[algo],
                    comparisons: comps,
                    swaps: swps,
                    time: time,
                    size: size,
                    pattern: PATTERN_NAMES[pat]
                });
                renderResults();
            }

            function renderResults() {
                if (results.length === 0) {
                    resultsList.innerHTML = '<div class="results-empty">No runs yet. Click Sort to begin.</div>';
                    return;
                }

                resultsList.innerHTML = results.map((r, i) => `
                    <div class="result-item">
                        <div class="result-algo">${r.algorithm}</div>
                        <div class="result-stats">
                            <div>Comparisons: <span>${r.comparisons}</span></div>
                            <div>Swaps: <span>${r.swaps}</span></div>
                            <div>Time: <span>${r.time}ms</span></div>
                            <div>Size: <span>${r.size}</span></div>
                            <div>Pattern: <span>${r.pattern}</span></div>
                        </div>
                    </div>
                `).join('');
            }

            function clearResults() {
                results = [];
                renderResults();
            }

            // Event listeners
            document.getElementById('sortBtn').addEventListener('click', startSort);
            document.getElementById('shuffleBtn').addEventListener('click', generateArray);
            document.getElementById('stopBtn').addEventListener('click', stopSort);
            document.getElementById('codeBtn').addEventListener('click', toggleCodePanel);
            document.getElementById('resultsBtn').addEventListener('click', toggleResultsPanel);
            document.getElementById('clearResultsBtn').addEventListener('click', clearResults);

            document.getElementById('runCodeBtn').addEventListener('click', () => {
                customCode[algorithm] = codeEditor.value;
                setCodeStatus('Code saved. Click Sort to run.', 'success');
            });

            document.getElementById('resetCodeBtn').addEventListener('click', () => {
                customCode[algorithm] = SORT_ALGORITHMS[algorithm];
                codeEditor.value = SORT_ALGORITHMS[algorithm];
                setCodeStatus('Code reset to default', 'success');
            });

            codeEditor.addEventListener('input', () => {
                setCodeStatus('Modified (click Run to save)', '');
            });

            // Handle tab key in editor
            codeEditor.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = codeEditor.selectionStart;
                    const end = codeEditor.selectionEnd;
                    codeEditor.value = codeEditor.value.substring(0, start) + '  ' + codeEditor.value.substring(end);
                    codeEditor.selectionStart = codeEditor.selectionEnd = start + 2;
                }
            });

            // Algorithm buttons
            document.querySelectorAll('[data-algo]').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (isAnimating) return;
                    document.querySelectorAll('[data-algo]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    algorithm = btn.dataset.algo;
                    document.getElementById('algoDisplay').textContent = ALGO_NAMES[algorithm];
                    updateCodeEditor();
                });
            });

            // Pattern buttons
            document.querySelectorAll('[data-pattern]').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (isAnimating) return;
                    document.querySelectorAll('[data-pattern]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    pattern = btn.dataset.pattern;
                    generateArray();
                });
            });

            // Sliders
            const sizeSlider = document.getElementById('sizeSlider');
            const sizeValue = document.getElementById('sizeValue');
            sizeSlider.addEventListener('input', (e) => {
                arraySize = parseInt(e.target.value);
                sizeValue.textContent = arraySize;
            });
            sizeSlider.addEventListener('change', () => {
                if (!isAnimating) generateArray();
            });

            const speedSlider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            speedSlider.addEventListener('input', (e) => {
                animationSpeed = parseInt(e.target.value);
                speedValue.textContent = animationSpeed;
            });

            // Help modal
            const helpModal = document.getElementById('helpModal');
            document.getElementById('helpBtn').addEventListener('click', () => {
                helpModal.classList.add('show');
            });
            document.getElementById('closeHelp').addEventListener('click', () => {
                helpModal.classList.remove('show');
            });
            helpModal.addEventListener('click', (e) => {
                if (e.target === helpModal) helpModal.classList.remove('show');
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

                switch (e.key) {
                    case ' ':
                        e.preventDefault();
                        if (isAnimating) stopSort();
                        else startSort();
                        break;
                    case 'r':
                    case 'R':
                        if (!isAnimating) generateArray();
                        break;
                    case 'e':
                    case 'E':
                        toggleCodePanel();
                        break;
                    case 'h':
                    case 'H':
                        toggleResultsPanel();
                        break;
                    case 'Escape':
                        stopSort();
                        if (helpModal.classList.contains('show')) helpModal.classList.remove('show');
                        break;
                    case '1':
                        document.querySelector('[data-algo="bubble"]').click();
                        break;
                    case '2':
                        document.querySelector('[data-algo="selection"]').click();
                        break;
                    case '3':
                        document.querySelector('[data-algo="insertion"]').click();
                        break;
                    case '4':
                        document.querySelector('[data-algo="merge"]').click();
                        break;
                    case '5':
                        document.querySelector('[data-algo="quick"]').click();
                        break;
                    case '6':
                        document.querySelector('[data-algo="heap"]').click();
                        break;
                }
            });

            // Resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => renderBars(), 100);
            });

            // Start
            init();
        </script>
    </body>
</html>
